#!/usr/bin/env bash
# Transfers a file from client to server using SCP

# Check parameter count
if [ "$#" -ne 4 ]; then
    echo "Usage: $0 PATH_TO_FILE IP USERNAME PATH_TO_SSH_KEY" >&2
    exit 1
fi

FILE="$1"
IP="$2"
USER="$3"
KEY="$4"

# Validate file existence
if [ ! -f "$FILE" ]; then
    echo "Error: File '$FILE' not found." >&2
    exit 1
fi

# Validate SSH key existence and permissions
if [ ! -f "$KEY" ]; then
    echo "Error: SSH key '$KEY' not found." >&2
    exit 1
elif [ "$(stat -c %a "$KEY")" != "600" ]; then
    echo "Error: SSH key must have 600 permissions." >&2
    exit 1
fi

# Transfer file with error handling
if scp -i "$KEY" -o StrictHostKeyChecking=no -o ConnectTimeout=10 "$FILE" "$USER@$IP:~"; then
    echo "File transferred to ~/$(basename "$FILE") on $IP."
else
    echo "Transfer failed. pls Check ur network, credentials, or server settings." >&2
    exit 1
fi
